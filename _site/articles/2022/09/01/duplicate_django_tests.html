<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Detecting Duplicate Django Tests &#8211; Devan</title>
<meta name="description" content="">
<meta name="keywords" content="notes, django, tdd, script">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Detecting Duplicate Django Tests">
<meta name="twitter:description" content="">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="Detecting Duplicate Django Tests">
<meta property="og:description" content="">
<meta property="og:url" content="http://localhost:4000/articles/2022/09/01/duplicate_django_tests.html">
<meta property="og:site_name" content="Devan">





<link rel="canonical" href="http://localhost:4000/articles/2022/09/01/duplicate_django_tests.html">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Devan Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>



<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="http://localhost:4000/about/" >About</a></li>
		  
		    
		    <li><a href="http://localhost:4000/articles/" >Articles</a></li>
		  
		    
		    <li><a href="http://localhost:4000/publications/" >Publications</a></li>
		  
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="http://localhost:4000/" class="site-logo" rel="home" title="Devan"><img src="http://localhost:4000/images/site-logo.png" width="200" height="200" alt="Devan logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Devan</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">A repository of thoughts and notes</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="http://localhost:4000/tags/#notes" title="Pages tagged notes">notes</a></li><li><a href="http://localhost:4000/tags/#django" title="Pages tagged django">django</a></li><li><a href="http://localhost:4000/tags/#tdd" title="Pages tagged tdd">tdd</a></li><li><a href="http://localhost:4000/tags/#script" title="Pages tagged script">script</a></li>
        </ul>
        
          <h1 class="entry-title">Detecting Duplicate Django Tests</h1>
        
      </header>
      <!--
        <footer class="entry-meta">
        
        
        <span class="author vcard">By <span class="fn"></span></span>
        <span class="entry-date date published"><time datetime="2022-09-01T00:00:00+08:00"><i class="fa fa-calendar-o"></i> September 01, 2022</time></span>
        
        
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=notes,django,tdd,script&amp;text=Detecting%20Duplicate%20Django%20Tests&amp;url=http://localhost:4000/articles/2022/09/01/duplicate_django_tests.html" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2022/09/01/duplicate_django_tests.html" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2022/09/01/duplicate_django_tests.html" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
        </footer>
      <div class="entry-content">
        <p>While improving the test coverage of a legacy Django code base, the question of
duplicate tests was raised. This particular code base moved towards using
end-to-end tests sometime in its past because the business logic became to
tangled to unit test.  As a result, with each new feature, more and more
end-to-end tests were piled on.</p>

<p>As part of an initial survey, the question was raised as to how many of our
tests were testing duplicated parts of the code base. And whether we could
eliminate any duplicate tests to speed up our runs.</p>

<p>To find out, I conducted an experiment to see what was the minimum number of
test I could run to keep the same level of coverage.</p>

<p>I first ran the entire test suite with coverage and made sure to enable dynamic
contexts. This creates an sqlite database which I could then mine. The database
provides the total number of tests as well as the lines tested by each test.
Also, we know the overall percentage of coverage as provided by the coverage
report.</p>

<p>The interesting bit, is how to select the minimum number of tests to get the
same percentage of coverage. Turns out, this is known as the set cover problem.
After going down the rabbit-hole if P vs NP algorithms, I eventually settled on
a <a href="http://www.martinbroadhurst.com/greedy-set-cover-in-python.html">greedy approach</a> for
best results.</p>

<p>After writing a python script to extract the set of tests. I could then re-run
coverage with that set of tests to verify that the percentage of coverage is the
same.</p>

<p>One interesting finding is was that with this particular code-base, I could
achieve the same percentage of coverage with one quarter of the number of tests.</p>

<p>You can download my python script <a href="/assets/script/duplicate_tests.py">here</a>.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/articles/2020/09/22/hello_startup_review.html" class="btn" title="Book Review: Hello Startup">Previous</a>
      
      
        <a href="http://localhost:4000/articles/2022/09/01/realisation_about_legacy_code.html" class="btn" title="A Moment of Enlightenment">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2025 . Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	
	
	
	
	
	
	
	
	
  
	
  <a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
